<!DOCTYPE html>
<html>
<head>
  <title>from: cha1yuh</title>
  <link rel="stylesheet" href="style.css">

  <!-- Firebase scripts -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
</head>
<body>
  <h1>Wyrdbox Chat</h1>

  <!-- Show current nickname -->
  <input id="nickname" disabled>

  <!-- Message input -->
  <input id="message" placeholder="Type a message">
  <button onclick="sendMessage()">Send</button>

  <!-- Chat messages -->
  <div id="chatbox"></div>

  <script>
    // Firebase setup
    firebase.initializeApp({
      apiKey: "AIzaSyCqILLxx2JAxstJ9LRIiqgFDWUTvAx4ZVs",
      authDomain: "chatbox-3c95d.firebaseapp.com",
      projectId: "chatbox-3c95d",
      storageBucket: "chatbox-3c95d.firebasestorage.app",
      messagingSenderId: "385714577506",
      appId: "1:385714577506:web:9308dc98ed8de92d00713b"
    });

    const db = firebase.firestore();

    // Get nickname from session
    let nickname = sessionStorage.getItem('nickname');
    if (!nickname) window.location.href = 'welcome.html';
    document.getElementById('nickname').value = nickname;

    // Send message
    function sendMessage() {
      const msg = document.getElementById('message').value;
      if (msg.trim() === "") return;

      db.collection("messages").add({
        nickname: nickname,
        text: msg,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      });

      document.getElementById('message').value = "";
    }

    // Listen for messages
    db.collection("messages")
      .orderBy("timestamp")
      .onSnapshot(snapshot => {
        const chatbox = document.getElementById("chatbox");
        chatbox.innerHTML = "";
        snapshot.forEach(doc => {
          const data = doc.data();
          chatbox.innerHTML += `<p><strong>${data.nickname}:</strong> ${data.text}</p>`;
        });
        chatbox.scrollTop = chatbox.scrollHeight;
      });
  </script>
</body>
</html>

